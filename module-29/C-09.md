# ‚ö° Prisma Performance Tips (Production Ready Guide)

‡¶è‡¶á ‡¶ó‡¶æ‡¶á‡¶°‡¶ü‡¶æ ‡¶ï‡¶æ‡¶ú‡ßá ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá ‡¶Ø‡¶ñ‡¶® ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá:

- ‡¶¨‡ßú table
- Dashboard / statistics
- High traffic
- Complex relations

---

## 1Ô∏è‚É£ `count()` ‡¶ì `aggregate()` ‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã

‚ùå ‡¶≠‡ßÅ‡¶≤

```ts
const posts = await prisma.post.findMany();
const total = posts.length;
```

‚úÖ ‡¶∏‡¶†‡¶ø‡¶ï

```ts
const total = await prisma.post.count();
```

üëâ DB-‡¶§‡ßá‡¶á ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶π‡¶¨‡ßá ‚Üí ‡¶ï‡¶Æ memory ‚Üí ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§

---

## 2Ô∏è‚É£ Dashboard-‡¶è `Promise.all()` ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã

‚ùå ‡¶è‡¶ï‡¶ü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶è‡¶ï‡¶ü‡¶æ query

```ts
const a = await prisma.post.count();
const b = await prisma.comment.count();
```

‚úÖ Parallel execution

```ts
const [a, b] = await Promise.all([prisma.post.count(), prisma.comment.count()]);
```

üëâ Response time ‡¶Ö‡¶®‡ßá‡¶ï ‡¶ï‡¶Æ‡ßá

---

## 3Ô∏è‚É£ `findMany()` ‡¶è ‡¶∏‡¶¨ field ‡¶ü‡ßá‡¶®‡ßã ‡¶®‡¶æ

‚ùå Heavy query

```ts
prisma.post.findMany({
  include: { comments: true, author: true },
});
```

‚úÖ Only required fields

```ts
prisma.post.findMany({
  select: {
    id: true,
    title: true,
  },
});
```

üëâ DB ‚Üí API data transfer ‡¶ï‡¶Æ‡ßá

---

## 4Ô∏è‚É£ `include` vs `select` ‡¶¨‡ßÅ‡¶ù‡ßá ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã

| Use case       | Use       |
| -------------- | --------- |
| relation ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ | `include` |
| specific field | `select`  |

‚ùå unnecessary relation

```ts
include: {
  comments: true;
}
```

---

## 5Ô∏è‚É£ Index ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã (‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£)

üìå ‡¶Ø‡ßá‡¶∏‡¶¨ field ‡¶¶‡¶ø‡ßü‡ßá filter / sort ‡¶ï‡¶∞‡ßã, ‡¶∏‡ßá‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá index ‡¶¶‡¶æ‡¶ì

```prisma
model Post {
  id        String   @id @default(uuid())
  status    PostStatus
  createdAt DateTime @default(now())

  @@index([status])
  @@index([createdAt])
}
```

üëâ Query 10x‚Äì100x ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá

---

## 6Ô∏è‚É£ Pagination ‡¶õ‡¶æ‡ßú‡¶æ `findMany()` ‡¶ï‡¶∞‡ßã ‡¶®‡¶æ

‚ùå Dangerous (large table)

```ts
prisma.post.findMany();
```

‚úÖ Safe

```ts
prisma.post.findMany({
  take: 20,
  skip: 0,
});
```

---

## 7Ô∏è‚É£ Cursor Pagination (High Performance)

```ts
prisma.post.findMany({
  take: 10,
  cursor: { id: lastId },
  skip: 1,
});
```

üëâ Infinite scroll + fast

---

## 8Ô∏è‚É£ Dashboard-‡¶è Transaction ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡ßã‡¶∞‡ßã ‡¶®‡¶æ

‚ùå

```ts
prisma.$transaction([prisma.post.count(), prisma.comment.count()]);
```

‚úÖ

```ts
Promise.all([...]);
```

üëâ Transaction = lock + slow

---

## 9Ô∏è‚É£ Aggregation ‡¶¶‡¶ø‡ßü‡ßá DB-‡¶§‡ßá ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡¶æ‡¶ì

‚ùå App-‡¶è ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨

```ts
posts.reduce(...)
```

‚úÖ DB-‡¶§‡ßá

```ts
prisma.post.aggregate({
  _sum: { views: true },
});
```

---

## üîü N+1 Query ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶è‡ßú‡¶ø‡ßü‡ßá ‡¶ö‡¶≤‡ßã

‚ùå

```ts
posts.map((p) => prisma.comment.count({ where: { postId: p.id } }));
```

‚úÖ

```ts
prisma.comment.groupBy({
  by: ["postId"],
  _count: true,
});
```

---

## 1Ô∏è‚É£1Ô∏è‚É£ Cache ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã (Dashboard must)

Dashboard-‡¶è‡¶∞ data ‡¶™‡ßç‡¶∞‡¶§‡¶ø request-‡¶è DB hit ‡¶ï‡¶∞‡¶æ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á‡•§

```ts
// Redis (concept)
getStats ‚Üí cache ‚Üí DB ‚Üí cache save
```

üëâ 10x faster dashboard

---

## 1Ô∏è‚É£2Ô∏è‚É£ Prisma Query Log ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡ßã

```ts
const prisma = new PrismaClient({
  log: ["query", "error"],
});
```

üëâ Slow query ‡¶ß‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá

---

## 1Ô∏è‚É£3Ô∏è‚É£ DB Connection Pool ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡ßã

PostgreSQL:

```env
DATABASE_URL=postgresql://...?connection_limit=10
```

üëâ High traffic-‡¶è crash ‡¶Ü‡¶ü‡¶ï‡¶æ‡ßü

---

## 1Ô∏è‚É£4Ô∏è‚É£ `deleteMany` / `updateMany` batch-‡¶è ‡¶ï‡¶∞‡ßã

‚ùå loop

```ts
for (const id of ids) {
  await prisma.post.delete({ where: { id } });
}
```

‚úÖ batch

```ts
prisma.post.deleteMany({
  where: { id: { in: ids } },
});
```

---

## üîë Performance Golden Rules

1Ô∏è‚É£ DB-‡¶§‡ßá‡¶á ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡¶æ‡¶ì
2Ô∏è‚É£ ‡¶ï‡¶Æ data ‡¶ü‡¶æ‡¶®‡ßã
3Ô∏è‚É£ Index ‡¶¶‡¶æ‡¶ì
4Ô∏è‚É£ Pagination ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï
5Ô∏è‚É£ Dashboard-‡¶è cache ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã

---

## üß† One-Line Summary

> **Prisma fast ‡¶π‡¶¨‡ßá ‡¶Ø‡¶¶‡¶ø ‡¶§‡ßÅ‡¶Æ‡¶ø database-‡¶ï‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶¶‡¶æ‡¶ì, app-‡¶ï‡ßá ‡¶®‡¶æ‡•§**
