# Prisma Aggregation / Grouping / Summarizing

‡¶ß‡¶∞‡¶ø DB-‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã data ‡¶Ü‡¶õ‡ßá (‡¶ß‡¶æ‡¶∞‡¶£‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø):

- Total Posts = 5
- Total Comments = 12
- Comment status:

  - PENDING = 3
  - APPROVED = 7
  - REJECTED = 2

---

## 1Ô∏è‚É£ `aggregate()` ‚Äî Basic Count Output

```ts
const result = await prisma.post.aggregate({
  _count: {
    id: true,
  },
});
```

### ‚úÖ Output

```json
{
  "_count": {
    "id": 5
  }
}
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

üëâ ‡¶Æ‡ßã‡¶ü **‡ß´‡¶ü‡¶æ post** ‡¶Ü‡¶õ‡ßá

---

## 2Ô∏è‚É£ `aggregate()` ‚Äî Min / Max Date Output

```ts
const result = await prisma.post.aggregate({
  _min: {
    createdAt: true,
  },
  _max: {
    createdAt: true,
  },
});
```

### ‚úÖ Output

```json
{
  "_min": {
    "createdAt": "2024-12-01T10:15:30.000Z"
  },
  "_max": {
    "createdAt": "2026-01-10T08:20:00.000Z"
  }
}
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

- ‡¶™‡ßç‡¶∞‡¶•‡¶Æ post ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá ‚Üí 2024-12-01
- ‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ post ‚Üí 2026-01-10

---

## 3Ô∏è‚É£ Numeric Aggregation (`_sum`, `_avg`, `_max`)

‡¶ß‡¶∞‡¶ø `views` field ‡¶Ü‡¶õ‡ßá‡•§

```ts
const stats = await prisma.post.aggregate({
  _sum: { views: true },
  _avg: { views: true },
  _max: { views: true },
});
```

### ‚úÖ Output

```json
{
  "_sum": {
    "views": 1200
  },
  "_avg": {
    "views": 240
  },
  "_max": {
    "views": 500
  }
}
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

- ‡¶Æ‡ßã‡¶ü views = 1200
- Average views/post = 240
- ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡ßá‡¶∂‡¶ø views = 500

---

## 4Ô∏è‚É£ Conditional Aggregate (`where` ‡¶∏‡¶π)

```ts
const approved = await prisma.comment.aggregate({
  where: {
    status: "APPROVED",
  },
  _count: true,
});
```

### ‚úÖ Output

```json
{
  "_count": {
    "id": 7
  }
}
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

üëâ **‡ß≠‡¶ü‡¶æ approved comment** ‡¶Ü‡¶õ‡ßá

---

## 5Ô∏è‚É£ `groupBy()` ‚Äî Status Wise Output

```ts
const result = await prisma.comment.groupBy({
  by: ["status"],
  _count: {
    id: true,
  },
});
```

### ‚úÖ Output

```json
[
  {
    "status": "PENDING",
    "_count": { "id": 3 }
  },
  {
    "status": "APPROVED",
    "_count": { "id": 7 }
  },
  {
    "status": "REJECTED",
    "_count": { "id": 2 }
  }
]
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

Admin dashboard-‡¶è status summary

---

## 6Ô∏è‚É£ `groupBy()` ‚Äî User Wise Post Count

```ts
const result = await prisma.post.groupBy({
  by: ["authorId"],
  _count: {
    id: true,
  },
});
```

### ‚úÖ Output

```json
[
  {
    "authorId": "user_1",
    "_count": { "id": 3 }
  },
  {
    "authorId": "user_2",
    "_count": { "id": 2 }
  }
]
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

- user_1 ‚Üí ‡ß©‡¶ü‡¶æ post
- user_2 ‚Üí ‡ß®‡¶ü‡¶æ post

---

## 7Ô∏è‚É£ `groupBy()` + `where` + `orderBy`

```ts
const result = await prisma.comment.groupBy({
  by: ["postId"],
  where: {
    status: "APPROVED",
  },
  _count: {
    id: true,
  },
  orderBy: {
    _count: {
      id: "desc",
    },
  },
});
```

### ‚úÖ Output

```json
[
  {
    "postId": "post_1",
    "_count": { "id": 5 }
  },
  {
    "postId": "post_2",
    "_count": { "id": 2 }
  }
]
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

- post_1 ‚Üí ‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶¨‡ßá‡¶∂‡¶ø approved comment
- post_2 ‚Üí ‡¶ï‡¶Æ

---

## 8Ô∏è‚É£ `groupBy()` + `having`

```ts
const result = await prisma.comment.groupBy({
  by: ["postId"],
  _count: {
    id: true,
  },
  having: {
    id: {
      _count: {
        gt: 3,
      },
    },
  },
});
```

### ‚úÖ Output

```json
[
  {
    "postId": "post_1",
    "_count": { "id": 5 }
  }
]
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

üëâ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶∏‡ßá‡¶á post ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶Ø‡ßá‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ comment **‡ß©‡¶ü‡¶ø‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø**

---

## 9Ô∏è‚É£ Simple Dashboard Count Output

```ts
const stats = {
  totalUsers: await prisma.user.count(),
  totalPosts: await prisma.post.count(),
  totalComments: await prisma.comment.count(),
};
```

### ‚úÖ Output

```json
{
  "totalUsers": 4,
  "totalPosts": 5,
  "totalComments": 12
}
```

### üìå ‡¶Æ‡¶æ‡¶®‡ßá

Admin overview card data

---

## üîç Aggregate vs GroupBy ‚Äî Output Shape Difference

### `aggregate()` Output

```json
{
  "_count": { "id": 5 },
  "_avg": { "views": 240 }
}
```

‚û°Ô∏è **Single object**

---

### `groupBy()` Output

```json
[
  { "status": "APPROVED", "_count": { "id": 7 } },
  { "status": "PENDING", "_count": { "id": 3 } }
]
```

‚û°Ô∏è **Array of objects**

---

## üßæ Final One-Look Summary

| Prisma Method | Output Type    | Example Use       |
| ------------- | -------------- | ----------------- |
| `count()`     | number         | total users       |
| `aggregate()` | object         | total / avg / sum |
| `groupBy()`   | array          | chart / analytics |
| `having`      | filtered array | threshold based   |
