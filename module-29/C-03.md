# ЁЯУМ Update User-Owned Posts

ржзрж░рж╛ ржпрж╛ржХ, ржЖржорж╛ржжрзЗрж░ ржХрж╛ржЫрзЗ ржПржХржЯрж┐ **Post** ржоржбрзЗрж▓ ржЖржЫрзЗ ржПржмржВ ржкрзНрж░рждрж┐ржЯрж┐ ржкрзЛрж╕рзНржЯрзЗрж░ ржПржХржЯрж┐ **userId** ржЖржЫрзЗ ржпрж╛ рж╕рзЗржЗ ржкрзЛрж╕рзНржЯрзЗрж░ ржорж╛рж▓рж┐ржХржХрзЗ ржирж┐рж░рзНржжрзЗрж╢ ржХрж░рзЗред

### Prisma Schema ржЙржжрж╛рж╣рж░ржг

```prisma
model User {
  id      String   @id @default(cuid())
  name    String
  email   String   @unique
  posts   Post[]
}

model Post {
  id        String   @id @default(cuid())
  title     String
  content   String?
  published Boolean  @default(false)
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}
```

ржПржЦрж╛ржирзЗ рж▓ржХрзНрж╖рзНржп ржХрж░рзЛ:

- **User** ржПржмржВ **Post** ржПрж░ ржоржзрзНржпрзЗ ржПржХ-ржерзЗржХрзЗ-ржмрж╣рзБ (1:N) рж╕ржорзНржкрж░рзНржХ ржЖржЫрзЗред
- ржкрзНрж░рждрж┐ржЯрж┐ ржкрзЛрж╕рзНржЯрзЗрж░ **userId** рж╕рзЗржЗ ржЗржЙржЬрж╛рж░ржХрзЗ ржирж┐рж░рзНржжрзЗрж╢ ржХрж░рзЗред

---

### рзия╕ПтГг User-Owned Posts Update ржХрж░рж╛рж░ ржЙржжрзНржжрзЗрж╢рзНржп

ржзрж░рзЛ, ржЖржорж╛ржжрзЗрж░ ржЪрж╛ржУржпрж╝рж╛ рж╣ржЪрзНржЫрзЗ:

1. ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЗржЙржЬрж╛рж░рзЗрж░ рж╕ржорж╕рзНржд ржкрзЛрж╕рзНржЯрзЗрж░ `published` status **true** ржХрж░рждрзЗред
2. ржЕржержмрж╛ ржЗржЙржЬрж╛рж░рзЗрж░ ржХрзЛржи ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрзЛрж╕рзНржЯрзЗрж░ `title` ржмрж╛ `content` update ржХрж░рждрзЗред

ржПржЯрж┐ ржХрж░рж╛ ржпрж╛ржмрзЗ **`updateMany`** ржмрж╛ **`update`** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред

---

### рзйя╕ПтГг ржЙржжрж╛рж╣рж░ржг рзз: рж╕ржорж╕рзНржд ржкрзЛрж╕рзНржЯрзЗрж░ status update ржХрж░рж╛

ржзрж░рж╛ ржпрж╛ржХ ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐ `userId = "abc123"`ред ржЖржорж░рж╛ рждрж╛рж░ рж╕ржорж╕рзНржд ржкрзЛрж╕рзНржЯ publish ржХрж░рждрзЗ ржЪрж╛ржЗ:

```ts
import { prisma } from "../prismaClient";

const publishUserPosts = async (userId: string) => {
  const updatedPosts = await prisma.post.updateMany({
    where: {
      userId: userId, // ржПржЗ ржЗржЙржЬрж╛рж░рзЗрж░ ржкрзЛрж╕рзНржЯржЧрзБрж▓рзЛржЗ select рж╣ржмрзЗ
      published: false, // рж╢рзБржзрзБ unpublished ржкрзЛрж╕рзНржЯржЧрзБрж▓рзЛ update рж╣ржмрзЗ
    },
    data: {
      published: true, // status update
    },
  });

  console.log("Updated posts count:", updatedPosts.count);
};

publishUserPosts("abc123");
```

тЬЕ ржмрзНржпрж╛ржЦрзНржпрж╛:

- **`updateMany`** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржЕржирзЗржХржЧрзБрж▓рзЛ ржкрзЛрж╕рзНржЯ ржПржХрж╕рж╛ржерзЗ update ржХрж░рж╛ ржпрж╛рзЯред
- `where` filter ржжрж┐рзЯрзЗ ржЖржорж░рж╛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЗржЙржЬрж╛рж░рзЗрж░ ржкрзЛрж╕рзНржЯ ржПржмржВ condition ржжрж┐рждрзЗ ржкрж╛рж░рж┐ред
- `data` ржЕржВрж╢рзЗ ржЖржорж░рж╛ ржпрзЗрж╕ржм field update ржХрж░рждрзЗ ржЪрж╛ржЗ рждрж╛ рж▓рж┐ржЦрж┐ред
- output `updatedPosts.count` ржжрзЗржЦрж╛рзЯ ржХрждржЧрзБрж▓рзЛ ржкрзЛрж╕рзНржЯ update рж╣рзЯрзЗржЫрзЗред

---

### рзкя╕ПтГг ржЙржжрж╛рж╣рж░ржг рзи: ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрзЛрж╕рзНржЯ update ржХрж░рж╛

ржзрж░рж╛ ржпрж╛ржХ ржЗржЙржЬрж╛рж░ рждрж╛рж░ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрзЛрж╕рзНржЯрзЗрж░ content update ржХрж░рждрзЗ ржЪрж╛рзЯ:

```ts
const updateSinglePost = async (
  userId: string,
  postId: string,
  newContent: string
) => {
  const updatedPost = await prisma.post.update({
    where: {
      id: postId,
    },
    data: {
      content: newContent,
    },
  });

  // Optional: check ownership
  if (updatedPost.userId !== userId) {
    throw new Error("Unauthorized: This post does not belong to the user");
  }

  console.log("Post updated:", updatedPost);
};

updateSinglePost("abc123", "post567", "This is the updated content.");
```

тЬЕ ржмрзНржпрж╛ржЦрзНржпрж╛:

- **`update`** рж╢рзБржзрзБ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ row update ржХрж░рзЗред
- `where` ржП ржЖржорж░рж╛ ржкрзЛрж╕рзНржЯрзЗрж░ **id** ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рж┐ред
- update ржХрж░рж╛рж░ ржЖржЧрзЗ optional ownership check ржХрж░рж╛ ржнрж╛рж▓рзЛ practiceред

---

### рзля╕ПтГг ржХрж┐ржЫрзБ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЯрж┐ржкрж╕

1. **Ownership validation**: ржЗржЙржЬрж╛рж░рзЗрж░ ржкрзЛрж╕рзНржЯ update ржХрж░рж╛рж░ ржЖржЧрзЗ рж╕рж░рзНржмржжрж╛ ржЪрзЗржХ ржХрж░рж╛ ржЙржЪрж┐ржд ржпрзЗ ржкрзЛрж╕рзНржЯржЯрж┐ рждрж╛рж░ржЗред
2. **Partial update**: Prisma ржжрж┐рзЯрзЗ рж╢рзБржзрзБ ржпрзЗржЗ fields update ржХрж░рждрзЗ ржЪрж╛ржУ, рж╢рзБржзрзБ рж╕рзЗржЧрзБрж▓рзЛ `data` рждрзЗ ржжрж╛ржУред
3. **Transaction usage**: ржпржжрж┐ ржПржХрж╛ржзрж┐ржХ update/insert ржПржХржЗ рж╕рж╛ржерзЗ ржХрж░рждрзЗ рж╣рзЯ, `prisma.$transaction` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛред
4. **Return value**:

   - `updateMany` тЖТ `{ count: number }`
   - `update` тЖТ updated object

---

### рзмя╕ПтГг ржЙржжрж╛рж╣рж░ржг рзй: Transaction ржПрж░ ржорж╛ржзрзНржпржорзЗ multiple updates

```ts
const updateUserPostsTransaction = async (userId: string) => {
  const [post1, post2] = await prisma.$transaction([
    prisma.post.updateMany({
      where: { userId, published: false },
      data: { published: true },
    }),
    prisma.post.update({
      where: { id: "specificPostId" },
      data: { title: "Updated Title" },
    }),
  ]);

  console.log(post1.count, post2);
};
```

тЬЕ ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ ржПржХрж╕рж╛ржерзЗ ржЕржирзЗржХржЧрзБрж▓рзЛ operation safely ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░рж┐ред

---

ЁЯТб **рж╕ржВржХрзНрж╖рзЗржкрзЗ**:

- **updateMany** тЖТ ржЕржирзЗржХржЧрзБрж▓рзЛ ржкрзЛрж╕рзНржЯ update ржХрж░рждрзЗред
- **update** тЖТ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрзЛрж╕рзНржЯ update ржХрж░рждрзЗред
- **ownership check** ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред
- **transaction** тЖТ multiple updates safe ржХрж░рждрзЗред
