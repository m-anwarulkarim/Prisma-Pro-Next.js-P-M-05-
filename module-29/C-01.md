# üåê Global Error Handling ‡¶ï‡ßÄ?

**Global Error Handling** ‡¶Æ‡¶æ‡¶®‡ßá ‡¶π‡¶≤‡ßã, ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡ßÅ‡¶≤ (error) ‡¶ò‡¶ü‡¶≤‡ßá ‡¶∏‡ßá‡¶ü‡¶æ **‡¶è‡¶ï ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶ß‡¶∞‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá handle ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ** ‡¶ï‡¶∞‡¶æ‡•§

‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá:

- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ crash ‡¶π‡¶Ø‡¶º ‡¶®‡¶æ‡•§
- ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶ï‡ßá ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡¶≠‡¶æ‡¶¨‡ßá error message ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§
- ‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶π‡¶ú ‡¶π‡¶Ø‡¶º‡•§

---

## 1Ô∏è‚É£ ‡¶ï‡ßá‡¶® ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞?

- **‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ crash ‡¶π‡¶Ø‡¶º ‡¶®‡¶æ:** Unexpected error ‡¶π‡¶≤‡ßá‡¶ì ‡¶™‡ßÅ‡¶∞‡ßã ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶Æ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§
- **Consistency:** ‡¶∏‡¶¨ error ‡¶è‡¶ï‡¶á‡¶≠‡¶æ‡¶¨‡ßá manage ‡¶π‡¶Ø‡¶º‡•§
- **‡¶°‡¶ø‡¶¨‡¶æ‡¶ó ‡¶∏‡¶π‡¶ú:** ‡¶∏‡¶¨ error centralized ‡¶•‡¶æ‡¶ï‡¶æ‡¶Ø‡¶º ‡¶ï‡ßã‡¶® ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡¶Ø‡¶º ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‡¶§‡¶æ ‡¶∏‡¶π‡¶ú‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§
- **User experience ‡¶≠‡¶æ‡¶≤‡ßã ‡¶π‡¶Ø‡¶º:** ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá clean ‡¶ì understandable error message ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§

---

## 2Ô∏è‚É£ Global Error Handling ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá?

1. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ ‡¶∏‡¶¨ async code ‡¶¨‡¶æ request ‡¶è **try-catch block** ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡•§
2. ‡¶ï‡ßã‡¶®‡ßã error ‡¶ò‡¶ü‡¶≤‡ßá, ‡¶∏‡ßá‡¶ü‡¶æ catch ‡¶ï‡¶∞‡ßá **centralized function (global error handler)** ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡•§
3. centralized function decide ‡¶ï‡¶∞‡ßá:

   - User ‡¶ï‡ßá ‡¶ï‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
   - Error log ‡¶ï‡ßã‡¶•‡¶æ‡¶Ø‡¶º ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá
   - ‡¶ï‡ßã‡¶® HTTP status code ‡¶™‡¶æ‡¶†‡¶æ‡¶¨‡ßá

üí° Node.js/Express ‡¶è ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ `next(err)` ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶è‡¶á centralized handler ‡¶è error ‡¶™‡¶æ‡¶†‡¶æ‡¶á‡•§

---

## 3 catchAsync Utility

**src/utils/catchAsync.ts**

```ts
import { Request, Response, NextFunction } from "express";

// Async controller wrapper: try-catch ‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ñ‡¶æ‡¶∞ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á
type AsyncFunction = (
  req: Request,
  res: Response,
  next: NextFunction
) => Promise<any>;

export const catchAsync = (fn: AsyncFunction) => {
  return (req: Request, res: Response, next: NextFunction) => {
    fn(req, res, next).catch(next); // Error ‡¶π‡¶≤‡ßá automatic global handler ‡¶è ‡¶Ø‡¶æ‡¶Ø‡¶º
  };
};
```

‚úÖ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ: Controller clean ‡¶•‡¶æ‡¶ï‡ßá, async error centralized handler ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡•§

---

## 4. Service Layer

**src/services/userService.ts**

```ts
// Database ‡¶¨‡¶æ business logic ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶Ø‡¶º
export const getUserById = async (id: string) => {
  if (!id) {
    const error = new Error("User ID missing!");
    (error as any).statusCode = 400; // HTTP status code attach
    throw error;
  }

  // Normally: Prisma database query ‡¶π‡¶¨‡ßá
  const user = { id, name: "Anwarul", email: "anwarul@example.com" };

  return user;
};

export const createUser = async (data: { name: string; email: string }) => {
  if (!data.name || !data.email) {
    const error = new Error("Name or Email missing!");
    (error as any).statusCode = 400;
    throw error;
  }

  // Normally: Prisma create query
  const user = { id: "123", ...data };

  return user;
};
```

‚úÖ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ:

- Controller clean ‡¶•‡¶æ‡¶ï‡ßá
- ‡¶∏‡¶¨ database / logic ‡¶è‡¶ï ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶•‡¶æ‡¶ï‡ßá
- Error throw ‡¶ï‡¶∞‡¶≤‡ßá centralized handler ‡¶è ‡¶Ø‡¶æ‡¶Ø‡¶º

---

## 5. Controller

**src/controllers/userController.ts**

```ts
import { Request, Response } from "express";
import { catchAsync } from "../utils/catchAsync";
import * as userService from "../services/userService";

// Get user
export const getUser = catchAsync(async (req: Request, res: Response) => {
  const user = await userService.getUserById(req.params.id);

  res.status(200).json({
    success: true,
    data: user,
  });
});

// Create user
export const createUser = catchAsync(async (req: Request, res: Response) => {
  const user = await userService.createUser(req.body);

  res.status(201).json({
    success: true,
    data: user,
  });
});
```

‚úÖ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ:

- Controller ‡¶∂‡ßÅ‡¶ß‡ßÅ request-response handle ‡¶ï‡¶∞‡ßá
- All async error automatically global handler ‡¶è ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º

---

## 6. Routes

**src/routes/userRoutes.ts**

```ts
import express from "express";
import { getUser, createUser } from "../controllers/userController";

const router = express.Router();

router.get("/:id", getUser); // Get single user
router.post("/", createUser); // Create new user

export default router;
```

---

## 7. Global Error Handler

**src/middlewares/globalErrorHandler.ts**

```ts
import { Request, Response, NextFunction } from "express";

export const globalErrorHandler = (
  err: any,
  req: Request,
  res: Response,
  next: NextFunction
) => {
  console.error("Error:", err.message); // Console ‡¶è log

  res.status(err.statusCode || 500).json({
    success: false,
    message: err.message || "Server Error",
  });
};
```

‚úÖ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ:

- ‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ error centralized
- User ‡¶ï‡ßá understandable message ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º
- HTTP status code consistent ‡¶•‡¶æ‡¶ï‡ßá

---

## 8. App & Server

**src/app.ts**

```ts
import express from "express";
import userRoutes from "./routes/userRoutes";
import { globalErrorHandler } from "./middlewares/globalErrorHandler";

const app = express();

app.use(express.json());

// Routes
app.use("/api/users", userRoutes);

// ‡¶∏‡¶¨ route ‡¶∂‡ßá‡¶∑‡ßá global error handler
app.use(globalErrorHandler);

export default app;
```

**src/server.ts**

```ts
import app from "./app";

const PORT = 3000;

app.listen(PORT, () => {
  console.log(`Server running on http://localhost:${PORT}`);
});
```

---

## 9. ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ

1. Controller ‡¶∂‡ßÅ‡¶ß‡ßÅ **request-response** handle ‡¶ï‡¶∞‡ßá‡•§
2. Service layer ‡¶∂‡ßÅ‡¶ß‡ßÅ **logic / database** handle ‡¶ï‡¶∞‡ßá‡•§
3. catchAsync ‡¶¶‡¶ø‡ßü‡ßá **async error automatic** global handler ‡¶è ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§
4. Global error handler ‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ error centralized manage ‡¶ï‡¶∞‡ßá‡•§
5. Future ‡¶è database, validation, external API ‡¶∏‡¶¨ clean‡¶≠‡¶æ‡¶¨‡ßá integrate ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§
