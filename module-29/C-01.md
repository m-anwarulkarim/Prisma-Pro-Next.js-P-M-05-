# üìå Prisma Client Known Request Errors ‚Äî Full Guide (Bangla)

## üîé Prisma Client Known Request Error ‡¶ï‡ßÄ?

Prisma ‡¶Ø‡¶ñ‡¶® **valid query ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßá‡¶ì database rule ‡¶≠‡ßá‡¶ô‡ßá ‡¶Ø‡¶æ‡ßü**, ‡¶§‡¶ñ‡¶®
üëâ **`PrismaClientKnownRequestError`** throw ‡¶ï‡¶∞‡ßá‡•§

‡¶Ø‡ßá‡¶Æ‡¶®:

- Duplicate value
- Foreign key mismatch
- Record ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ
- Input ‡¶¨‡ßá‡¶∂‡¶ø ‡¶≤‡¶Æ‡ßç‡¶¨‡¶æ

‡¶è‡¶ó‡ßÅ‡¶≤‡ßã **bug ‡¶®‡¶æ**, ‡¶¨‡¶∞‡¶Ç **data / constraint related problem**‡•§

---

## üß≠ ‡¶ï‡¶ñ‡¶® ‡¶è‡¶á error ‡¶Ü‡¶∏‡ßá?

| ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ                 | ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£                      |
| ---------------------- | --------------------------- |
| Unique constraint fail | ‡¶è‡¶ï‡¶á email ‡¶Ü‡¶¨‡¶æ‡¶∞ insert       |
| Record missing         | update/delete ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ id ‡¶®‡ßá‡¶á |
| Relation error         | ‡¶≠‡ßÅ‡¶≤ foreign key             |
| Invalid input          | varchar limit ‡¶õ‡¶æ‡ßú‡¶æ‡¶®‡ßã        |

---

## üß† High-Level Rule (‡¶Æ‡ßÅ‡¶ñ‡¶∏‡ßç‡¶•)

> ‚ùå Controller ‡¶è Prisma error handle ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
> ‚ùå Service ‡¶è ‡¶∏‡¶¨ Prisma error map ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
> ‚úÖ Global Error Handler ‡¶è Prisma Known Errors handle ‡¶ï‡¶∞‡¶¨‡ßá
> ‚úÖ Service ‡¶∂‡ßÅ‡¶ß‡ßÅ error **throw** ‡¶ï‡¶∞‡¶¨‡ßá

---

## üìÇ Recommended Folder Structure

```text
src/
 ‚î£ errors/
 ‚îÉ ‚îó handlePrismaError.ts
 ‚î£ middlewares/
 ‚îÉ ‚îó globalErrorHandler.ts
 ‚î£ utils/
 ‚îÉ ‚îó catchAsync.ts
 ‚î£ modules/
 ‚îÉ ‚îó post/
 ‚îÉ   ‚î£ post.controller.ts
 ‚îÉ   ‚î£ post.service.ts
```

---

# üî• Most Common Prisma Known Error Codes (Real Life)

---

## 1Ô∏è‚É£ P2002 ‚Äî Unique Constraint Failed

### üß® ‡¶ï‡¶ñ‡¶® ‡¶π‡ßü?

- Duplicate email / username / slug

```ts
err.code === "P2002";
```

### üìå Example

```ts
await prisma.user.create({
  data: { email: "test@gmail.com" },
});
```

### ‚úÖ Client Response

```json
{
  "success": false,
  "message": "Duplicate value for email"
}
```

---

## 2Ô∏è‚É£ P2025 ‚Äî Record Not Found

### üß® ‡¶ï‡¶ñ‡¶® ‡¶π‡ßü?

- update / delete ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ id ‡¶®‡¶æ‡¶á

```ts
err.code === "P2025";
```

### üìå Example

```ts
await prisma.post.update({
  where: { id: "123" },
  data: { title: "Updated" },
});
```

### ‚úÖ Client Response

```json
{
  "success": false,
  "message": "Record not found"
}
```

---

## 3Ô∏è‚É£ P2003 ‚Äî Foreign Key Constraint Failed

### üß® ‡¶ï‡¶ñ‡¶® ‡¶π‡ßü?

- relation id ‡¶≠‡ßÅ‡¶≤

```ts
err.code === "P2003";
```

### üìå Example

```ts
await prisma.post.create({
  data: { authorId: "invalid-id" },
});
```

### ‚úÖ Client Response

```json
{
  "success": false,
  "message": "Invalid foreign key reference"
}
```

---

## 4Ô∏è‚É£ P2000 ‚Äî Input Value Too Long

### üß® ‡¶ï‡¶ñ‡¶® ‡¶π‡ßü?

- varchar length ‡¶õ‡¶æ‡ßú‡¶ø‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá

```ts
err.code === "P2000";
```

### üìå Example

```ts
title: "x".repeat(500);
```

### ‚úÖ Client Response

```json
{
  "success": false,
  "message": "Input value is too long"
}
```

---

## 5Ô∏è‚É£ P2014 ‚Äî Required Relation Missing

### üß® ‡¶ï‡¶ñ‡¶® ‡¶π‡ßü?

- required relation ‡¶®‡¶æ ‡¶¶‡¶ø‡ßü‡ßá create

---

## 6Ô∏è‚É£ P2016 ‚Äî Query Interpretation Error

### üß® ‡¶ï‡¶ñ‡¶® ‡¶π‡ßü?

- ‡¶≠‡ßÅ‡¶≤ where condition

---

# üß† Prisma Known Errors vs Others

| Error Type                 | ‡¶ï‡ßá handle ‡¶ï‡¶∞‡¶¨‡ßá        |
| -------------------------- | --------------------- |
| Prisma Known Request Error | Global Error Handler  |
| Validation error (Zod)     | Validation Middleware |
| Auth error                 | Auth Middleware       |
| Business logic error       | Service (AppError)    |
| Unexpected bug             | Global Error Handler  |

---

## üß© handlePrismaError.ts (Final Version)

```ts
export const handlePrismaError = (err: any) => {
  switch (err.code) {
    case "P2002":
      return {
        statusCode: 409,
        message: `Duplicate value for ${err.meta?.target?.join(", ")}`,
      };

    case "P2025":
      return {
        statusCode: 404,
        message: "Record not found",
      };

    case "P2003":
      return {
        statusCode: 400,
        message: "Invalid foreign key reference",
      };

    case "P2000":
      return {
        statusCode: 400,
        message: "Input value is too long",
      };

    default:
      return {
        statusCode: 500,
        message: "Database error",
      };
  }
};
```

---

# üîÅ Full Error Lifecycle (‡¶è‡¶ï ‡¶≤‡¶æ‡¶á‡¶®‡ßá)

> Prisma error ‚Üí Service throw ‚Üí Controller (catchAsync) ‚Üí Global Error Handler ‚Üí handlePrismaError ‚Üí Client

---

## üßæ Golden Rule (Interview Answer üíº)

> **Prisma Client Known Request Errors ‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü Global Error Handler ‡¶è handle ‡¶ï‡¶∞‡¶æ ‡¶â‡¶ö‡¶ø‡¶§,
> Controller ‡¶¨‡¶æ Service ‡¶è ‡¶®‡ßü‡•§**
