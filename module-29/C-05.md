# üîê Prisma: Role-Based Post Deletion (User-Owned & Admin-Level Access)

## üéØ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø

‡¶è‡¶á ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‚Äî

- ‚úÖ **ADMIN** ‚Üí ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã Post delete ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá
- ‚úÖ **AUTHOR / USER** ‚Üí ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ Post delete ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá
- ‚ùå ‡¶Ö‡¶®‡ßç‡¶Ø USER ‚Üí ‡¶Ö‡¶®‡ßç‡¶Ø‡ßá‡¶∞ Post delete ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ

üëâ Authentication: **Better Auth**
üëâ Authorization: **Prisma Enum Role**

---

## üìå Controller (Request Handler)

```ts
export const deletePostController = async (req, res) => {
  const { postId } = req.params;
  const user = req.user; // Better Auth ‡¶•‡ßá‡¶ï‡ßá

  const deletedPost = await deletePost(
    postId,
    user.id,
    user.role // Prisma Enum
  );

  res.status(200).json({
    success: true,
    message: "Post deleted successfully",
    data: deletedPost,
  });
};
```

### Controller-‡¶è‡¶∞ ‡¶¶‡¶æ‡ßü‡¶ø‡¶§‡ßç‡¶¨

- URL ‡¶•‡ßá‡¶ï‡ßá `postId` ‡¶®‡ßá‡¶ì‡ßü‡¶æ
- Authenticated user (`req.user`) ‡¶®‡ßá‡¶ì‡ßü‡¶æ
- ‡¶∏‡¶¨ data **service layer**-‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
- HTTP response ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã

üìå **Controller ‡¶ï‡ßã‡¶®‡ßã permission ‡¶¨‡¶æ role check ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ**

---

## üìå Service (Business Logic + Authorization)

```ts
import { Role } from "@prisma/client";
import { ForbiddenError, NotFoundError } from "@/errors";

export const deletePost = async (postId, userId, userRole) => {
  // 1Ô∏è‚É£ Post existence check
  const post = await prisma.post.findUnique({
    where: { id: postId },
  });

  if (!post) {
    throw new NotFoundError("Post not found");
  }

  // 2Ô∏è‚É£ Authorization check
  const isAdmin = userRole === Role.ADMIN;
  const isAuthor = post.authorId === userId;

  if (!isAdmin && !isAuthor) {
    throw new ForbiddenError("You are not allowed to delete this post");
  }

  // 3Ô∏è‚É£ Delete Post
  return prisma.post.delete({
    where: { id: postId },
  });
};
```

---

## üß† Service Layer ‡¶ï‡ßÄ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶õ‡ßá?

### 1Ô∏è‚É£ Post Existence Check

- ‡¶≠‡ßÅ‡¶≤ `postId` ‡¶¶‡¶ø‡¶≤‡ßá delete ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
- DB consistency ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ

### 2Ô∏è‚É£ Authorization Logic

```ts
ADMIN        ‚Üí allowed
AUTHOR       ‚Üí allowed
OTHER USER   ‚Üí forbidden
```

### 3Ô∏è‚É£ Secure Delete

- ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ user/delete ‡¶ï‡¶∞‡¶≤‡ßá Post DB ‡¶•‡ßá‡¶ï‡ßá remove ‡¶π‡ßü

---

## üîÑ Overall Flow (Simple)

```
Controller
  ‚Üì
Service
  ‚îú‚îÄ Post check
  ‚îú‚îÄ Role & ownership check
  ‚Üì
Prisma delete
  ‚Üì
Controller response
```
