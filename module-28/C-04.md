## тЬЕ Post List with Comment Count

```ts
import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();

export const getPostsWithComments = async () => {
  try {
    const posts = await prisma.post.findMany({
      include: {
        author: {
          select: { id: true, name: true, image: true },
        },
        _count: {
          select: { comments: true }, // ржорзЛржЯ ржХржорзЗржирзНржЯ рж╕ржВржЦрзНржпрж╛ (ржЯржк-рж▓рзЗржнрзЗрж▓ + рж░рж┐ржкрзНрж▓рж╛ржЗ)
        },
      },
      orderBy: { createdAt: "desc" },
    });

    // ржкрзНрж░рждрж┐ржЯрж┐ ржкрзЛрж╕рзНржЯрзЗрж░ ржЬржирзНржп ржЯржк-рж▓рзЗржнрзЗрж▓ ржХржорзЗржирзНржЯ рж╕ржВржЦрзНржпрж╛ ржмрзЗрж░ ржХрж░рж╛
    const postsWithCounts = await Promise.all(
      posts.map(async (post) => {
        const topLevelCount = await prisma.comment.count({
          where: { postId: post.id, parentId: null },
        });

        return {
          ...post,
          commentCount: post._count.comments, // ржорзЛржЯ ржХржорзЗржирзНржЯ рж╕ржВржЦрзНржпрж╛
          topLevelCommentCount: topLevelCount, // рж╢рзБржзрзБ ржЯржк-рж▓рзЗржнрзЗрж▓ ржХржорзЗржирзНржЯ рж╕ржВржЦрзНржпрж╛
        };
      })
    );

    return postsWithCounts;
  } catch (error) {
    console.error("Get Posts Error:", error);
    throw new Error(error.message || "Failed to get posts");
  }
};
```

`postsWithCounts` **ржорзВрж▓ ржЙржжрзНржжрзЗрж╢рзНржп:** ржкрзНрж░рждрж┐ржЯрж┐ ржкрзЛрж╕рзНржЯрзЗрж░ ржЖржирзНржбрж╛рж░рзЗ ржХрзЯржЯрж┐ **ржорзЗржЗржи ржХржорзЗржирзНржЯ** (рж░рж┐ржкрзНрж▓рж╛ржЗ ржмрж╛ржжрзЗ) ржЖржЫрзЗ, рждрж╛ ржЧржгржирж╛ ржХрж░рж╛ред

### рзз. `posts.map` ржПржмржВ `Promise.all`

ржпрзЗрж╣рзЗрждрзБ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржЕржирзЗржХржЧрзБрж▓рзЛ ржкрзЛрж╕рзНржЯрзЗрж░ ржПржХржЯрж┐ рж▓рж┐рж╕рзНржЯ (`posts`) ржЖржЫрзЗ, рждрж╛ржЗ ржкрзНрж░рждрж┐ржЯрж┐ ржкрзЛрж╕рзНржЯрзЗрж░ ржЬржирзНржп ржЖрж▓рж╛ржжрж╛ржнрж╛ржмрзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржЪрзЗржХ ржХрж░рждрзЗ рж╣ржмрзЗред `Promise.all` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ ржпрж╛рждрзЗ рж╕ржм ржкрзЛрж╕рзНржЯрзЗрж░ ржЧржгржирж╛ ржкрзНрж░ржХрзНрж░рж┐рзЯрж╛ржЯрж┐ ржжрзНрж░рзБржд ржПржмржВ ржПржХрж╕рж╛ржерзЗ рж╕ржорзНржкржирзНржи рж╣рзЯред

### рзи. `prisma.comment.count`

ржПржЯрж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕ржХрзЗ ржХржорж╛ржирзНржб ржжрж┐ржЪрзНржЫрзЗ рж╢рзБржзрзБ рж╕ржВржЦрзНржпрж╛ржЯрж┐ (Count) ржжрж┐рждрзЗ, ржкрзБрж░рзЛ ржХржорзЗржирзНржЯрзЗрж░ ржбрж╛ржЯрж╛ ржирзЯред ржПрждрзЗ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржУржкрж░ ржЪрж╛ржк ржХржо ржкрзЬрзЗред

### рзй. ржлрж┐рж▓рзНржЯрж╛рж░рж┐ржВ рж▓ржЬрж┐ржХ (`where` clause)

ржПржЦрж╛ржирзЗ ржжрзБржЯрж┐ рж╢рж░рзНржд ржжрзЗржУрзЯрж╛ рж╣рзЯрзЗржЫрзЗ:

- **`postId: post.id`**: рж╢рзБржзрзБржорж╛рждрзНрж░ ржУржЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрзЛрж╕рзНржЯрзЗрж░ ржХржорзЗржирзНржЯржЧрзБрж▓рзЛ ржЧрзБржиржмрзЗред
- **`parentId: null`**: ржПржЯрж┐ рж╕ржмржЪрзЗрзЯрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржгред ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕рж░рж╛рж╕рж░рж┐ ржкрзЛрж╕рзНржЯрзЗ ржХрж░рж╛ **ржорзЗржЗржи ржХржорзЗржирзНржЯржЧрзБрж▓рзЛ** ржЧрзЛржирж╛ рж╣ржЪрзНржЫрзЗред ржХрзЛржирзЛ рж░рж┐ржкрзНрж▓рж╛ржЗ (ржЙрждрзНрждрж░) ржПржЦрж╛ржирзЗ ржЧрзЛржирж╛ рж╣ржмрзЗ ржирж╛ред

---

**рж╕ржВржХрзНрж╖рзЗржкрзЗ:**
ржПржЗ ржХрзЛржбржЯрж┐ рж▓рзБржк ржЪрж╛рж▓рж┐рзЯрзЗ ржкрзНрж░рждрж┐ржЯрж┐ ржкрзЛрж╕рзНржЯрзЗрж░ ржЬржирзНржп рждрж╛рж░ **ржЯржк-рж▓рзЗржнрзЗрж▓ ржХржорзЗржирзНржЯ рж╕ржВржЦрзНржпрж╛** ржмрзЗрж░ ржХрж░рзЗ ржЖржиржЫрзЗ, ржпрж╛ рж╕рж╛ржзрж╛рж░ржгржд рж╕рзЛрж╢рзНржпрж╛рж▓ ржорж┐ржбрж┐рзЯрж╛ ржлрж┐ржбрзЗ "Comments (5)" ржмрж╛ "рззрзжржЯрж┐ ржоржирзНрждржмрзНржп" рж╣рж┐рж╕рзЗржмрзЗ ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣рзЯред

---

## ЁЯФО Example Response

**GET `/api/posts`**

```json
[
  {
    "id": "post_1",
    "title": "First Post",
    "author": { "id": "user_1", "name": "Arif" },
    "commentCount": 5, // ржорзЛржЯ ржХржорзЗржирзНржЯ рж╕ржВржЦрзНржпрж╛
    "topLevelCommentCount": 3 // рж╢рзБржзрзБ ржЯржк-рж▓рзЗржнрзЗрж▓ ржХржорзЗржирзНржЯ рж╕ржВржЦрзНржпрж╛
  },
  {
    "id": "post_2",
    "title": "Second Post",
    "author": { "id": "user_2", "name": "Rahim" },
    "commentCount": 2,
    "topLevelCommentCount": 2
  }
]
```
