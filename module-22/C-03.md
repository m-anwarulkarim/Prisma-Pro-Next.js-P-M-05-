## ЁЯЪА Prisma Migration, Client & Query (ржмрж╛ржВрж▓рж╛ ржЧрж╛ржЗржб)

ржкрзНрж░рж┐-рж░рж┐ржХрзБржЗржЬрж┐ржЯ рж╣рж┐рж╕рзЗржмрзЗ ржЖржкржирж╛рж░ `schema.prisma` ржлрж╛ржЗрж▓ржЯрж┐ рждрзИрж░рж┐ ржерж╛ржХрж╛рж░ ржкрж░ ржирж┐ржЪрзЗрж░ ржзрж╛ржкржЧрзБрж▓рзЛ ржЕржирзБрж╕рж░ржг ржХрж░рзБржиред

---

### ЁЯУМ рзз. ржкрзНрж░ржержо ржорж╛ржЗржЧрзНрж░рзЗрж╢ржи ржУ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЯрзЗржмрж┐рж▓ ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рж╛

Prisma Schema ржлрж╛ржЗрж▓рзЗ рж▓рзЗржЦрж╛ ржоржбрзЗрж▓ржЧрзБрж▓рзЛржХрзЗ (User, Post ржЗрждрзНржпрж╛ржжрж┐) PostgreSQL ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ **ржЯрзЗржмрж┐рж▓ ржЖржХрж╛рж░рзЗ рж░рзВржкрж╛ржирзНрждрж░** ржХрж░рждрзЗ ржорж╛ржЗржЧрзНрж░рзЗрж╢ржи ржкрзНрж░рзЯрзЛржЬржиред

**ржХржорж╛ржирзНржб:**

```bash
npx prisma migrate dev --name init

```

**ржПржЗ ржХржорж╛ржирзНржбржЯрж┐ ржпрж╛ ржпрж╛ ржХрж░рзЗ:**

1. **Schema Reading:** ржЖржкржирж╛рж░ `schema.prisma` ржлрж╛ржЗрж▓ржЯрж┐ ржкрзЬрзЗред
2. **Table Creation:** рж╕рзЗржЗ ржЕржирзБржпрж╛рзЯрзА PostgreSQL-ржП ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржХрж░рзЗред
3. **Migration History:** `prisma/migrations` ржлрзЛрж▓рзНржбрж╛рж░рзЗ ржПржХржЯрж┐ SQL ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзЗ ржпрж╛ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ рж░рзЗржХрж░рзНржб рж░рж╛ржЦрзЗред
4. **Client Generation:** рж╕рзНржмрзЯржВржХрзНрж░рж┐рзЯржнрж╛ржмрзЗ Prisma Client ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рзЗред

---

### ЁЯУМ рзи. Prisma Client ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рж╛

ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐рж░ ржкрж░ Prisma Client ржЬрзЗржирж╛рж░рзЗржЯ ржХрж░рждрзЗ рж╣рзЯред ржПржЯрж┐ ржорзВрж▓ржд ржПржХржЯрж┐ ржЕржЯрзЛржорзЗржЯрж┐ржХ ржЬрзЗржирж╛рж░рзЗржЯрзЗржб TypeScript рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ред

**ржХржорж╛ржирзНржб:**

```bash
npx prisma generate

```

**ржХрзЗржи ржПржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг?**
ржПржЯрж┐ ржЖржкржирж╛рж░ ржоржбрзЗрж▓ ржЕржирзБржпрж╛рзЯрзА ржлрж╛ржВрж╢ржи рждрзИрж░рж┐ ржХрж░рзЗ (ржпрзЗржоржи: `user.create()`, `post.findMany()`) ржПржмржВ рж╕ржорзНржкрзВрж░рзНржг **Type-Safe** ржЕржнрж┐ржЬрзНржЮрждрж╛ ржжрзЗрзЯред ржЕрж░рзНржерж╛рзО, ржЗржорзЗржЗрж▓ ржлрж┐рж▓рзНржбрзЗ ржирж╛ржорзНржмрж╛рж░ ржкрж╛ржарж╛рж▓рзЗ TypeScript ржХрзЛржб рж░рж╛ржи ржХрж░рж╛рж░ ржЖржЧрзЗржЗ ржПрж░рж░ ржзрж░рж┐рзЯрзЗ ржжрзЗржмрзЗред

---

### ЁЯУМ рзй. Prisma Client ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕ рждрзИрж░рж┐ (lib/prisma.ts)

ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржмрж┐ржнрж┐ржирзНржи ржЬрж╛рзЯржЧрж╛ ржерзЗржХрзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрзБрзЯрзЗрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ рж╕рзЗржирзНржЯрзНрж░рж╛рж▓ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рж╛ ржнрж╛рж▓рзЛред PostgreSQL-ржПрж░ рж╕рж╛ржерзЗ ржХрж╛ржирзЗржХрзНржЯ ржХрж░рждрзЗ ржЖржорж░рж╛ ржПржХржЯрж┐ **Driver Adapter** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмред

**ЁЯУД ржлрж╛ржЗрж▓: `lib/prisma.ts**`

```ts
import "dotenv/config";
import { PrismaPg } from "@prisma/adapter-pg";
import { PrismaClient } from "../generated/prisma/client";

const connectionString = `${process.env.DATABASE_URL}`;

// рзз. PostgreSQL ржЕрзНржпрж╛ржбрж╛ржкрзНржЯрж╛рж░ рждрзИрж░рж┐
const adapter = new PrismaPg({ connectionString });

// рзи. Prisma Client ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕ рждрзИрж░рж┐
const prisma = new PrismaClient({ adapter });

export { prisma };
```

---

### ЁЯУМ рзк. ржкрзНрж░ржержо ржХрзБрзЯрзЗрж░рж┐ (Data CRUD ржЕржкрж╛рж░рзЗрж╢ржи)

ржПржЦржи ржПржХржЯрж┐ ржЯрзЗрж╕рзНржЯ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ рж▓рж┐ржЦрзЗ ржжрзЗржЦрж╛ ржпрж╛ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржарж┐ржХржорждрзЛ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ред

**ЁЯУД ржлрж╛ржЗрж▓: `script.ts**`

```ts
import { prisma } from "./lib/prisma";

async function main() {
  // рзз. ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐ + рж╕рж╛ржерзЗ ржПржХржЯрж┐ ржкрзЛрж╕рзНржЯ ржпрзБржХрзНржд ржХрж░рж╛ (Relation)
  const user = await prisma.user.create({
    data: {
      name: "Alice",
      email: "alice@prisma.io",
      posts: {
        create: {
          title: "Prisma is Awesome!",
          content: "This is my first post using Prisma Client.",
          published: true,
        },
      },
    },
    include: { posts: true }, // ржЖржЙржЯржкрзБржЯрзЗ ржкрзЛрж╕рзНржЯ ржжрзЗржЦрж╛рж░ ржЬржирзНржп
  });
  console.log("Created User:", user);

  // рзи. рж╕ржм ржЗржЙржЬрж╛рж░ ржУ рждрж╛ржжрзЗрж░ рж░рж┐рж▓рзЗржЯрзЗржб ржкрзЛрж╕рзНржЯ ржкрзЬрж╛
  const allUsers = await prisma.user.findMany({
    include: { posts: true },
  });
  console.log("All Users with Posts:", JSON.stringify(allUsers, null, 2));
}

main()
  .then(async () => await prisma.$disconnect())
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
```

**рж░рж╛ржи ржХрж░рж╛рж░ ржХржорж╛ржирзНржб:**

```bash
npx tsx script.ts

```

---

### ЁЯУМ рзл. Prisma Studio (ржнрж┐ржЬрзНржпрзБржпрж╝рж╛рж▓ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржорзНржпрж╛ржирзЗржЬрж╛рж░)

Prisma Studio рж╣рж▓рзЛ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржорзНржпрж╛ржирзЗржЬ ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржЗржи-ржмрж┐рж▓рзНржЯ ржЧрзНрж░рж╛ржлрж┐ржХрзНржпрж╛рж▓ ржЗржЙржЬрж╛рж░ ржЗржирзНржЯрж╛рж░ржлрзЗрж╕ (GUI)ред ржПржЯрж┐ ржЕржирзЗржХржЯрж╛ Excel рж╢рж┐ржЯрзЗрж░ ржорждрзЛ ржбрж╛ржЯрж╛ ржжрзЗржЦрж╛ ржПржмржВ ржПржбрж┐ржЯ ржХрж░рж╛рж░ рж╕рзБржмрж┐ржзрж╛ ржжрзЗрзЯред

**ржХржорж╛ржирзНржб:**

```bash
npx prisma studio

```

ржПржЯрж┐ ржЪрж╛рж▓рж╛ржирзЛрж░ ржкрж░ ржЖржкржирж╛рж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ `http://localhost:5555` ржУржкрзЗржи рж╣ржмрзЗред

---

### ЁЯУЛ ржжрзНрж░рзБржд рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк (Summary)

| ржХржорж╛ржирзНржб                 | ржХрж╛ржЬ                                         |
| ---------------------- | ------------------------------------------- |
| `prisma migrate dev`   | ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЯрзЗржмрж┐рж▓ рждрзИрж░рж┐ ржУ ржЖржкржбрзЗржЯ ржХрж░рзЗред             |
| `prisma generate`      | ржХрзБрзЯрзЗрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп Client рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ рждрзИрж░рж┐ ржХрж░рзЗред |
| `prisma studio`        | ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржжрзЗржЦрж╛рж░ ржЬржирзНржп GUI ржУржкрзЗржи ржХрж░рзЗред  |
| `prisma.$disconnect()` | ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрж╛ржирзЗржХрж╢ржи рж╕ржлрж▓ржнрж╛ржмрзЗ ржмржирзНржз ржХрж░рзЗред           |
