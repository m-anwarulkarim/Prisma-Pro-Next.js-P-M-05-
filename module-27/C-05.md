## Sorting

ডেটাবেসের ভাষায় **Sorting** মানে হলো ডেটাগুলোকে একটি নির্দিষ্ট ক্রমে (Order) সাজানো। যেমন: নামের ক্রমানুসারে (A-Z), দামের ভিত্তিতে (কম থেকে বেশি), অথবা নতুন ডেটাগুলো আগে দেখানো।

Prisma-তে Sorting করার জন্য আমরা **`orderBy`** কিওয়ার্ডটি ব্যবহার করি। নিচে এর পুরো কনসেপ্ট :

---

### ১. সর্টিং-এর মূল দুটি ধরণ (asc vs desc)

সর্টিং করার সময় আমাদের বলে দিতে হয় আমরা কোন দিকে সাজাতে চাই:

- **`asc` (Ascending):** ছোট থেকে বড় (১, ২, ৩... বা A, B, C...)।
- **`desc` (Descending):** বড় থেকে ছোট (১০, ৯, ৮... বা Z, Y, X...) অথবা নতুন থেকে পুরোনো।

---

### ২. সাধারণ সর্টিং (Single Field Sorting)

যদি আপনি চান আপনার ব্লগের পোস্টগুলো সব সময় **নতুন থেকে পুরোনো** ক্রমে থাকবে (অর্থাৎ লেটেস্ট পোস্ট আগে আসবে), তবে কোডটি হবে এমন:

```javascript
const posts = await prisma.post.findMany({
  orderBy: {
    createdAt: "desc", // 'desc' মানে নতুনগুলো সবার উপরে থাকবে
  },
});
```

আবার যদি ইউজারদের নামের সিরিয়াল অনুযায়ী সাজাতে চান (A থেকে Z):

```javascript
const users = await prisma.user.findMany({
  orderBy: {
    name: "asc", // 'asc' মানে A আগে আসবে, তারপর B, তারপর C
  },
});
```

---

### ৩. মাল্টিপল সর্টিং (Multiple Field Sorting)

কখনও কখনও আমাদের একের অধিক কলাম দিয়ে সর্ট করতে হয়। ধরুন, আপনি চান ইউজারদের প্রথমে তাদের **ভূমিকা (Role)** অনুযায়ী সাজাতে, আর একই রোলের ভেতর যাদের **নাম** আগে আসে তাদের আগে দেখাতে।

```javascript
const users = await prisma.user.findMany({
  orderBy: [
    { role: "asc" }, // প্রথমে Role দিয়ে সাজাবে (Admin আগে, তারপর User)
    { name: "asc" }, // যদি দুজনেই Admin হয়, তবে যার নাম আগে আসে তাকে আগে দেখাবে
  ],
});
```

---

### ৪. Pagination-এর সাথে Sorting কেন জরুরি?

Pagination-এ (বিশেষ করে Cursor-based) সর্টিং থাকা বাধ্যতামূলক। কারণ:

- আপনি যদি ডাটা সর্ট না করেন, তবে প্রতিবার পেজ লোড হওয়ার সময় ডাটা এলোমেলো হয়ে আসতে পারে।
- **Offset Pagination**-এ আমরা সাধারণত `id` বা `createdAt` দিয়ে সর্ট করি যাতে ইউজাররা পেজ পাল্টানোর সময় সিরিয়াল ঠিক থাকে।

**বাস্তব উদাহরণ (Pagination + Sorting):**

```javascript
const page = 1;
const limit = 10;

const result = await prisma.product.findMany({
  skip: (page - 1) * limit,
  take: limit,
  orderBy: {
    price: "asc", // সবচেয়ে কম দামি প্রোডাক্টগুলো আগে দেখাবে
  },
});
```

---

### ৫. রিলেশনাল সর্টিং (Sorting by Relation)

আপনি চাইলে অন্য টেবিলের ডেটার ওপর ভিত্তি করেও সর্ট করতে পারেন। যেমন: পোস্টের তালিকার ক্ষেত্রে এমনভাবে সাজানো যাতে যে পোস্টে সবচেয়ে বেশি কমেন্ট আছে তা আগে থাকে (যদি রিলেশন থাকে):

```javascript
const posts = await prisma.post.findMany({
  orderBy: {
    comments: {
      _count: "desc", // যে পোস্টে কমেন্ট সংখ্যা বেশি সেটি আগে আসবে
    },
  },
});
```

---

### ৬. প্র্যাকটিক্যাল টিপস (req.query থেকে সর্টিং)

বাস্তবে ইউজার হয়তো ড্রপডাউন থেকে সিলেক্ট করে দিবে সে "Price: Low to High" না কি "Newest First" দেখতে চায়। তখন কোডটি এমন হবে:

```javascript
app.get("/products", async (req, res) => {
  const sortOrder = req.query.sort === "price_low" ? "asc" : "desc";

  const products = await prisma.product.findMany({
    orderBy: {
      price: sortOrder,
    },
  });
  res.json(products);
});
```

### সারসংক্ষেপ:

- **`asc`**: ছোট থেকে বড় / পুরোনো থেকে নতুন।
- **`desc`**: বড় থেকে ছোট / নতুন থেকে পুরোনো।
- **`orderBy`**: এই প্রপার্টি ব্যবহার করে Prisma-তে সর্ট করা হয়।
- সর্টিং ছাড়া Pagination করলে ডেটা ডুপ্লিকেট বা মিস হওয়ার সম্ভাবনা থাকে।
