# ЁЯУМ Prisma Client Unknown Error тАФ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрзНржпрж╛ржЦрзНржпрж╛ (ржмрзНржпржмрж╣рж╛рж░ ржЫрж╛рзЬрж╛)

## 1я╕ПтГг Prisma Client Unknown Error ржХрзА?

- **Prisma Client** ржпржЦржи ржХрзЛржирзЛ query DB-рждрзЗ ржкрж╛ржарж╛ржпрж╝, ржХрж┐ржирзНрждрзБ ржХрзЛржирзЛ **ржЕржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд рж╕ржорж╕рзНржпрж╛** ржШржЯрзЗ, рждржЦржи ржПржЯрж┐ **Unknown Error** ржЫрзЛржБрзЬрзЗред
- ржПржЯрж┐ Prisma-ржПрж░ тАЬknownтАЭ error types (ржпрзЗржоржи `PrismaClientKnownRequestError`) ржиржпрж╝ред
- ржорзВрж▓ржд ржПржЗ error-ржЯрж┐ рж╣рзЯ **ржЕржЬрж╛ржирж╛ ржмрж╛ unhandled рж╕ржорж╕рзНржпрж╛** ржПрж░ ржХрж╛рж░ржгрзЗред

> ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк: DB connection drop, query timeout, unsupported operation ржЗрждрзНржпрж╛ржжрж┐ред

---

## 2я╕ПтГг ржХржЦржи ржЖрж╕рзЗ Unknown Error?

### рж╕рж╛ржзрж╛рж░ржг ржХрж╛рж░ржгрж╕ржорзВрж╣:

1. **DB connection lost**

   - Prisma query ржкрж╛ржарж╛ржЪрзНржЫрзЗ ржХрж┐ржирзНрждрзБ DB ржХрж╛ржирзЗржХрж╢ржи ржмржирзНржз ржмрж╛ drop рж╣ржпрж╝рзЗржЫрзЗред

2. **Query timeout**

   - DB query рж╢рзЗрж╖ рж╣рждрзЗ ржмрзЗрж╢рж┐ рж╕ржоржпрж╝ ржирж┐ржЪрзНржЫрзЗред

3. **Unsupported query**

   - Prisma engine ржпрзЗ query generate ржХрж░ржЫрзЗ рж╕рзЗржЯрж┐ DB support ржХрж░ржЫрзЗ ржирж╛ред

4. **Internal Prisma bug / Rust panic**

   - ржЦрзБржм рж░рзЗрзЯрж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ Prisma engine crash ржХрж░рзЗред

5. **Network issues**

   - DB host-ржПрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧрзЗ рж╕ржорж╕рзНржпрж╛ред

---

## 3я╕ПтГг Unknown Error ржПрж░ ржзрж░ржи

Prisma documentation ржЕржирзБржпрж╛ржпрж╝рзА:

| Error Name                        | ржмрзНржпрж╛ржЦрзНржпрж╛                                 |
| --------------------------------- | ---------------------------------------- |
| `PrismaClientKnownRequestError`   | Field ржнрзБрж▓, unique constraint, etc.       |
| `PrismaClientValidationError`     | Query structure / required field missing |
| `PrismaClientRustPanicError`      | Prisma engine crash / Rust panic         |
| `PrismaClientUnknownRequestError` | Unhandled DB / network / internal error  |
| `PrismaClientInitializationError` | Prisma client рж╢рзБрж░рзБ ржХрж░рждрзЗ ржкрж╛рж░рзЗржирж┐           |

> Unknown Error ржорж╛ржирзЗ DB ржмрж╛ Prisma engine ржерзЗржХрзЗ **ржЕржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд рж╕ржорж╕рзНржпрж╛** ржПрж╕рзЗржЫрзЗ, ржпрж╛ Prisma ржирж┐ржЬрзЗржЗ classify ржХрж░рждрзЗ ржкрж╛рж░рзЗржирж┐ред

---

## 4я╕ПтГг Debugging ржПржмржВ ржмрзЛржЭрж╛рж░ ржзрж╛ржк

1. **Query ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзЛ**

   - Prisma `DEBUG="prisma:client"` ржЪрж╛рж▓рж╛рж▓рзЗ ржжрзЗржЦрж╛ ржпрж╛ржпрж╝ Prisma ржХрзА query ржкрж╛ржарж╛ржЪрзНржЫрзЗред

2. **DB рж▓ржЧ ржЪрзЗржХ ржХрж░рзЛ**

   - Connection/timeout ржмрж╛ network рж╕ржорж╕рзНржпрж╛ ржЖржЫрзЗ ржХрж┐ржирж╛ред

3. **Version update ржХрж░рзЛ**

   - Prisma ржПрж░ ржирждрзБржи version ржЕржирзЗржХ bug fix ржХрж░рзЗред

4. **Server ржмрж╛ Network ржкрж░рзАржХрзНрж╖рж╛**

   - Remote DB рж╣рж▓рзЗ network stability check ржХрж░рзЛред

5. **Repeatable test**

   - Unknown Error ржХрж┐ repeated рж╣рзЯ ржирж╛ржХрж┐ random, рждрж╛ ржжрзЗржЦрж╛рж░ ржЬржирзНржп query multiple ржмрж╛рж░ run ржХрж░рзЛред

---

## 5я╕ПтГг рж╕ржВржХрзНрж╖рж┐ржкрзНржд рж╕рж╛рж░рж╛ржВрж╢

- Unknown Error = **ржЕржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд, ржЕржЬрж╛ржирж╛ рж╕ржорж╕рзНржпрж╛**ред
- ржорзВрж▓ржд: connection loss, timeout, unsupported query, internal bug ржмрж╛ network problemред
- ржПржЧрзБрж▓рзЛ predictable ржирзЯ тЖТ рждрж╛ржЗ **catch & log** ржирж╛ ржХрж░рж▓рзЗ debugging ржХржарж┐ржи рж╣рзЯред
- Unknown Error рж╣ржЪрзНржЫрзЗ **Prisma Client-ржПрж░ safeguard** ржпрж╛ ржЬрж╛ржирж╛рзЯ ржХрж┐ржЫрзБ ржарж┐ржХржарж╛ржХ рж╣рзЯржирж┐ред

# ЁЯУМ Full Usage of PrismaClientUnknownRequestError

## 1я╕ПтГг catchAsync Utility

- Async controller ржерзЗржХрзЗ automatic errors handle ржХрж░рждрзЗ ржмрзНржпржмрж╣рж╛рж░ рж╣рзЯред

```ts
// utils/catchAsync.ts
export const catchAsync = (fn: Function) => {
  return (req: any, res: any, next: any) => {
    fn(req, res, next).catch(next);
  };
};
```

---

## 2я╕ПтГг Service Layer

- Prisma query wrap ржХрж░рзЗ try-catch ржПрж░ ржоржзрзНржпрзЗред
- Unknown Error specifically catch ржХрж░рж╛ рж╣рзЯред

```ts
// services/user.service.ts
import { PrismaClient, Prisma } from "@prisma/client";
const prisma = new PrismaClient();

export const getAllUsers = async () => {
  try {
    const users = await prisma.user.findMany();
    return users;
  } catch (error: any) {
    // Unknown Error handle ржХрж░рж╛
    if (error instanceof Prisma.PrismaClientUnknownRequestError) {
      console.error("ЁЯФе Prisma Unknown Error:", error.message);
      // ржЪрж╛ржЗрж▓рзЗ custom error throw ржХрж░рж╛ ржпрж╛рзЯ
      throw new Error("Database connection or internal error occurred.");
    }

    // ржЕржирзНржп Prisma error
    if (error instanceof Prisma.PrismaClientKnownRequestError) {
      console.error("тЪа Known Request Error:", error.message);
      throw error;
    }

    // ржЕржирзНржп general error
    throw error;
  }
};
```

---

## 3я╕ПтГг Controller Layer

- catchAsync ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ async error centralize ржХрж░рж╛ред

```ts
// controllers/user.controller.ts
import { Request, Response } from "express";
import { getAllUsers } from "../services/user.service";
import { catchAsync } from "../utils/catchAsync";

export const getUsersController = catchAsync(
  async (req: Request, res: Response) => {
    const users = await getAllUsers();
    res.status(200).json({ status: "success", data: users });
  }
);
```

---

## 4я╕ПтГг Global Error Middleware

- рж╕ржм Unknown Error centralized рж╣рзНржпрж╛ржирзНржбрзЗрж▓ рж╣рзЯред
- Production ржПржмржВ development ржЕржирзБржпрж╛рзЯрзА response customize ржХрж░рж╛ ржпрж╛рзЯред

```ts
// middleware/errorHandler.ts
import { Request, Response, NextFunction } from "express";
import { Prisma } from "@prisma/client";

export const globalErrorHandler = (
  err: any,
  req: Request,
  res: Response,
  next: NextFunction
) => {
  console.error("ЁЯТе Error caught by global handler:", err);

  if (err instanceof Prisma.PrismaClientUnknownRequestError) {
    return res.status(500).json({
      status: "error",
      message: "Database Unknown Error: Please try again later.",
    });
  }

  if (err instanceof Prisma.PrismaClientKnownRequestError) {
    return res.status(400).json({
      status: "fail",
      message: err.message,
    });
  }

  if (err instanceof Prisma.PrismaClientValidationError) {
    return res.status(400).json({
      status: "fail",
      message: err.message,
    });
  }

  return res.status(500).json({
    status: "error",
    message: err.message || "Something went wrong.",
  });
};
```

---

## 5я╕ПтГг Express App ржП Integration

```ts
// app.ts
import express from "express";
import { getUsersController } from "./controllers/user.controller";
import { globalErrorHandler } from "./middleware/errorHandler";

const app = express();

app.use(express.json());

// Routes
app.get("/users", getUsersController);

// Global Error Handler
app.use(globalErrorHandler);

app.listen(3000, () => console.log("Server running on port 3000"));
```

---

## ЁЯФ╣ Workflow Summary

1. **Service** тЖТ Prisma query try-catch, Unknown Error specifically catchред
2. **Controller** тЖТ catchAsync ржжрж┐рзЯрзЗ рж╕ржм error global handler-ржП ржкрж╛ржарж╛ржирзЛред
3. **Global Handler** тЖТ Unknown Error & ржЕржирзНржпрж╛ржирзНржп Prisma errors centralized handleред
4. **Response** тЖТ User friendly, debugging рж╕рж╣ safeред

ЁЯТб **Result:**

- ржХрзЛржирзЛ unexpected DB problem рж╣рж▓рзЗ **Unknown Error** gracefully handle рж╣ржмрзЗред
- Production environment ржП crash рж╣ржмрзЗ ржирж╛, proper JSON response ржпрж╛ржмрзЗред
